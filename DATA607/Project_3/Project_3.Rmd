---
title: "Project_3"
author: "Emerald Orcas"
date: "3/17/2020"
output: html_document
---

```{r setup, include=FALSE}
library(dplyr)
library(tidyr)
library(ggplot2)
library(RCurl)
library(stringr)
library(pdp)
knitr::opts_chunk$set(echo = TRUE)
```

## Project 3 : Valuable Data Scientist Skills

The purpose of Project 3 is to use data to answer the question, "Which are the most valued data science skills?". 

After initial brainstorming, we determined to use the following dataset to perform analysis: https://www.kaggle.com/elroyggj/indeed-dataset-data-scientistanalystengineer/kernels.

The dataset takes data science job postings and breaks them down by industry, company, skills, job titles, location and categorical job types (data scientist, data analyst, and data engineer). 

We determind this is an appropriate dataset since it is employers that generally determine what are valued skill sets in an occupation.


```{r}
#Import indeed dataset

url <- getURL("https://raw.githubusercontent.com/geeman1209/MSDATA2020/master/DATA607/Project_3/indeed_job_dataset.csv")

raw_data <- read.csv(text = url)


#get rid of unnecessary columns
df_1 <- raw_data
drops <- c("X","Link","Company","No_of_Reviews","No_of_Stars","Date_Since_Posted","Company_Revenue","Company_Employees", "Description", "Location")
df_1 <- select(df_1 ,-c(drops))

#delete the columns 17-27
df_2 <- select(df_1, -c(17:27))
```

```{r calculate-additional-columns}
#add single column to flag job titles for Junior or Senior level data science jobs in the Job Title
df_2['Level'] <- ifelse(grepl("Jr|Junior",ignore.case=TRUE,df_2$Job_Title),'Junior',ifelse(grepl("Sr|Senior",ignore.case=TRUE,df_2$Job_Title),"Senior","Other"))

#add single column for industry
df_2['Industry'] <- ifelse(df_2$Consulting.and.Business.Services==1,'Consulting&Business',ifelse(df_2$Internet.and.Software,'Internet&Software',ifelse(df_2$Banks.and.Financial.Services==1,'Banks&FiancialServices',ifelse(df_2$Health.Care==1,'HealthCare',ifelse(df_2$Insurance==1,'Insurance',ifelse(df_2$Other_industries==1,'Other',NA))))))

```

# Data Analysis  
What are the most popular skills for a data scientist? Do these top skils differ for data analysts and data engineers?  
```{r most-common-skills}
skills <- df_2 %>% group_by(Job_Type) %>% summarise(sum(python),sum(sql),sum(machine.learning),sum(r),sum(hadoop),sum(tableau),sum(sas),sum(spark),sum(java),sum(Others))
colnames(skills) <- c('Job_Type','Python','SQL','Machine_Learning','R','Hadoop','Tableau','SAS','Spark','Java','Others')
skills <- pivot_longer(skills,cols=c(2:11),names_to = "Skill",values_to = "Count")

job_type_count <- df_2 %>% group_by(Job_Type) %>% tally()
a <- skills %>% inner_join(job_type_count,by="Job_Type")
skills['Total_Jobs']  <- a$n
skills['Perct_Total'] <- a$Count / a$n
  
ggplot(skills, aes(x=reorder(Skill,-Perct_Total),y=Perct_Total,fill=Job_Type)) +
  geom_bar(stat="identity", position = 'dodge') +
  xlab('Skill') +
  ylab('% of Total Postings that List this Skill') + 
  ggtitle('Top Skills on Job Listings - LinkedIn') +
  theme(plot.title = element_text(hjust = 0.5)) +
  theme(axis.text.x = element_text(angle = 90)) 
```
Do Skills Differ Among Junior vs. Senior Data Scientists?
```{r data-science-skills}
ds <- filter(df_2,Job_Type == 'data_scientist',Level %in% c("Senior","Junior"))
ds_skills <- ds %>% group_by(Level) %>% summarise(sum(python),sum(sql),sum(machine.learning),sum(r),sum(hadoop),sum(tableau),sum(sas),sum(spark),sum(java),sum(Others))
colnames(ds_skills) <- c('Level','Python','SQL','Machine_Learning','R','Hadoop','Tableau','SAS','Spark','Java','Others')
ds_skills_long <- pivot_longer(ds_skills,cols=c(2:11),names_to = "Skill",values_to = "Count")

ds_job_level<- df_2 %>% group_by(Level) %>% tally()
b <- ds_skills_long %>% inner_join(ds_job_level,by="Level")
ds_skills_long['Total_Jobs']  <- b$n
ds_skills_long['Perct_Total'] <- b$Count / b$n

senior <- filter(ds_skills_long,ds_skills_long$Level == "Senior")
s <- ggplot(senior, aes(x=reorder(Skill,Perct_Total),y=Perct_Total,fill=Level)) +
  geom_bar(stat="identity", position = 'dodge') +
  coord_flip() +
  xlab('Skill') +
  ylab('') + 
  ggtitle('Senior Level') +
  theme(plot.title = element_text(hjust = 0.5))

junior <- filter(ds_skills_long,ds_skills_long$Level == "Junior")
j <- ggplot(junior, aes(x=reorder(Skill,Perct_Total),y=Perct_Total,fill=Level)) +
  geom_bar(stat="identity", position = 'dodge') +
  coord_flip() +
  xlab('Skill') +
  ylab('% Postings with Skill') + 
  ggtitle('Junior Level') +
  theme(plot.title = element_text(hjust = 0.5))

grid.arrange(s,j,nrow=2,top = "Top Skills for Junior vs. Senior Data Scientists")

```
Which industries have the most job postings for data scientists?
```{r count-job-posting-by-industry}
posts_by_industry <- filter(df_2,Job_Type == 'data_scientist',is.na(df_2$Industry) == FALSE)
industry_count <- posts_by_industry %>% group_by(Industry) %>% tally()

colnames(industry_count) <- c('Industry','Count')

ggplot(industry_count, aes(x=reorder(Industry,Count),y=Count)) +
  geom_bar(stat="identity", position = 'dodge') +
  coord_flip() +
  xlab('Industry') +
  ylab('Count of Job Postings') + 
  ggtitle('Top 10 Skills Among Data Job Listings - LinkedIn') +
  theme(plot.title = element_text(hjust = 0.5))
```

# Let's take the top skills to see which pay the highest salary for data scientists?
```{r avg-highest-salary}
ds_salary <- select(filter(df_2,df_2$Job_Type=='data_scientist'), Queried_Salary,python,sql,machine.learning,r)
ds_salary_job_type <- pivot_longer(ds_salary,cols=c(2:5),names_to='Skill')
skill <- ds_salary_job_type %>% group_by(Queried_Salary,Skill) %>% summarise(sum(value))
colnames(skill) <- c('Salary_Range','Skill','Count')

ggplot(skill, aes(x=Salary_Range,y=Count,fill=Skill)) +
  geom_bar(stat="identity", position = 'dodge')+
  xlab('Salary Range') +
  ylab('Count of Postings') +
  theme(axis.text.x = element_text(angle = 90)) + 
  ggtitle("Highest Paying Skills") +
  theme(plot.title = element_text(hjust = 0.5)) 
```

Do certain industries require certain skills? We're going to ignore OTHER since it's overwhelmingly popular and we don't know which industries it represents.
```{r industry-skills}
#remove rows where industry is NA or OTHER
industry <- filter(df_2,Job_Type == 'data_scientist',df_2$Industry != 'Other',is.na(df_2$Industry) == FALSE)
industry_skills <- industry %>% group_by(Industry) %>% summarise(sum(python),sum(sql),sum(machine.learning),sum(r),sum(hadoop),sum(tableau),sum(sas),sum(spark),sum(java),sum(Others))

colnames(industry_skills) <- c('Industry','Python','SQL','Machine_Learning','R','Hadoop','Tableau','SAS','Spark','Java','Others')

industry_skills <- pivot_longer(industry_skills,cols=c(2:11),names_to = "Skill",values_to = "Count")

#Internet & Software
internet <- filter(industry_skills,industry_skills$Industry %in% c('Internet&Software','Consulting&Business'))
a <- ggplot(internet_consulting, aes(x=reorder(Skill,-Count),y=Count,fill=Industry)) +
  geom_bar(stat="identity", position = 'dodge')+
  xlab('') +
  ylab('Count of Job Posts') +
  theme(axis.text.x = element_text(angle = 90)) +
  expand_limits(y = c(0, 400)) +
  theme(legend.position = c(0.6, 0.8))

#Healthcare, Insurance & Banks
healthcare_insurance_banks <- filter(industry_skills,industry_skills$Industry %in% c('HealthCare','Insurance','Banks&FinancialServices'))
b <- ggplot(healthcare_insurance_banks, aes(x=reorder(Skill,-Count),y=Count,fill=Industry)) +
  geom_bar(stat="identity", position = 'dodge')+
  xlab('Skill') +
  ylab('Count of Job Posts') +
  theme(axis.text.x = element_text(angle = 90)) +
  expand_limits(y = c(0,160)) + 
  theme(legend.position = c(0.6725, 0.8))

grid.arrange(a,b,nrow=1,top = "Top Skills Across Industry for Data Scientist Job Postings",widths=c(1,1))

```


# Including Plots


```{r pressure, echo=TRUE}
plot(pressure)
```
